/*!
 * Mumlife - Common Scripts.
 *
 * @version     2014-03-12 1.3.1
 * @author      Michael Giuliano <michael@beatscope.co.uk>
 * @copyright   2014 Beatscope Limited | http://www.beatscope.co.uk/
 */
/*!
 * jQuery Cookie plugin
 *
 * Copyright (c) 2010 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * Source: https://github.com/carhartl/jquery-cookie
 */
jQuery.cookie=function(e,f,b){if(arguments.length>1&&String(f)!=="[object Object]"){b=jQuery.extend({},b);if(f===null||f===undefined){b.expires=-1}if(typeof b.expires==="number"){var h=b.expires,c=b.expires=new Date();c.setDate(c.getDate()+h)}f=String(f);return(document.cookie=[encodeURIComponent(e),"=",b.raw?f:encodeURIComponent(f),b.expires?"; expires="+b.expires.toUTCString():"",b.path?"; path="+b.path:"",b.domain?"; domain="+b.domain:"",b.secure?"; secure":""].join(""))}b=f||{};var a,g=b.raw?function(i){return i}:decodeURIComponent;return(a=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?g(a[1]):null};
/*!
*   @name                           Elastic
*   @descripton                     Elastic is jQuery plugin that grow and shrink your textareas automatically
*   @version                        1.6.11
*   @requires                       jQuery 1.2.6+
*
*   @author                         Jan Jarfalk
*   @author-email                   jan.jarfalk@unwrongest.com
*   @author-website                 http://www.unwrongest.com
*
*   @licence                        MIT License - http://www.opensource.org/licenses/mit-license.php
*/
(function(a){jQuery.fn.extend({elastic:function(){var b=["paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","lineHeight","fontFamily","width","fontWeight","border-top-width","border-right-width","border-bottom-width","border-left-width","borderTopStyle","borderTopColor","borderRightStyle","borderRightColor","borderBottomStyle","borderBottomColor","borderLeftStyle","borderLeftColor"];return this.each(function(){if(this.type!=="textarea"){return false}var h=jQuery(this),c=jQuery("<div />").css({position:"absolute",display:"none","word-wrap":"break-word","white-space":"pre-wrap"}),k=parseInt(h.css("line-height"),10)||parseInt(h.css("font-size"),"10"),m=parseInt(h.css("height"),10)||k*3,l=parseInt(h.css("max-height"),10)||Number.MAX_VALUE,e=0;if(l<0){l=Number.MAX_VALUE}c.attr("id",h.attr("id")+"-twin");c.appendTo(h.parent());var g=b.length;while(g--){c.css(b[g].toString(),h.css(b[g].toString()))}function j(){var i=Math.floor(parseInt(h.width(),10));if(c.width()!==i){c.css({width:i+"px"});f(true)}}function n(i,p){var o=Math.floor(parseInt(i,10));if(h.height()!==o){h.css({height:o+"px",overflow:p})}}function f(q){var p=h.val().replace(/&/g,"&amp;").replace(/ {2}/g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />");var i=c.html().replace(/<br>/ig,"<br />");if(q||p+"&nbsp;"!==i){c.html(p+"&nbsp;");if(Math.abs(c.height()+k-h.height())>3){var o=c.height()+k;if(o>=l){n(l,"auto")}else{if(o<=m){n(m,"hidden")}else{n(o,"hidden")}}}}}h.css({overflow:"hidden"});h.bind("keyup change cut paste",function(i){f()});a(window).bind("resize",j);h.bind("resize",j);h.bind("update",f);h.bind("input paste",function(i){setTimeout(f,250)});f()})}})})(jQuery);
/*!
 * Mumlife - Common Scripts
 * (c) 2014 Beatscope Limited | http://www.beatscope.co.uk/
 */
function csrfSafeMethod(a){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(a))}$.ajaxSetup({crossDomain:true,cache:true,beforeSend:function(c,b){var a=$.cookie("csrftoken");if(!csrfSafeMethod(b.type)){c.setRequestHeader("X-CSRFToken",a);c.setRequestHeader("X-Requested-With","XMLHttpRequest")}}});if(typeof(ML)==="undefined"){var ML={}}function trim(b){if(!b||typeof(b)==="undefined"){return""}b=b.replace(/^\s+/,"");for(var a=b.length-1;a>=0;a--){if(/\S/.test(b.charAt(a))){b=b.substring(0,a+1);break}}return b}ML.Utils=function(){};ML.Utils.prototype.preventEnterSubmit=function(c){if(c.which==13){var a=$(c.target);if(!a.is("textarea")&&!a.is(":button,:submit")){var b=false;$(this).find(":input:visible:not([disabled],[readonly]), a").each(function(){if(this===c.target){b=true}else{if(b){$(this).focus();return false}}});return false}}};ML.utils=new ML.Utils();ML.Settings=function(a){this.settings={debug:a.debug,site_url:a.site_url,static_url:a.hasOwnProperty("static_url")?a.static_url:"/static/",api_url:a.api_url,csrf_token:$.cookie("csrftoken")}};ML.Settings.prototype.getSettings=function(){return this.settings};ML.Settings.prototype.get=function(a){if(this.settings.hasOwnProperty(a)){return this.settings[a]}};ML.Application=function(a){ML.settings=new ML.Settings(a);this.init()};ML.Application.prototype.init=function(){this.version=null;if(location.search){var a=location.search.substr(1).split("&");for(var c in a){var b=a[c].split("=");if(b[0]=="version"){this.version=trim(b[1]);if(this.version==""){this.version=null}$.cookie("version",this.version,{path:"/"});location.search=location.search.replace("?"+a[c],"").replace("&"+a[c],"");break}}}if($.cookie("version")){this.version=$.cookie("version")}if(!this.version){if(platform.product){this.version="mobile"}else{this.version="desktop"}}if(!$.cookie("ck_allowed")){setTimeout(function(){$("#mumlifecookies").slideDown()},500);$("#cookies-continue-button").click(function(){$.cookie("ck_allowed",1,{expires:365,path:"/"});$("#mumlifecookies").slideUp()})}new ML.Menu();new ML.Search();new ML.Slider();new ML.FullScreen();setTimeout(function(){new ML.Notifications()},250);$(document).trigger("ml.Ready")};if(!window.ML){window.ML=ML}ML.Menu=function(){$('[data-entity="menu"]').click(function(){if($("#menu").is(":visible")){$("#menu").slideUp(250)}else{$("#menu").slideDown(250)}$(this).blur();return false})};ML.Search=function(){$('[data-entity="search"]').click(function(){if($('[data-entity="search-form"]').is(":visible")){$('[data-entity="search-form"]').slideUp(250)}else{$('[data-entity="search-form"]').slideDown(250,function(){$('[data-entity="search"]').blur();$('[data-entity="search-form"] input[type="text"]').focus()})}return false})};ML.Slider=function(){$('[data-entity="slider"]').click(function(){if($('[data-entity="slider-form"]').is(":visible")){$('[data-entity="slider-form"]').slideUp(250)}else{$('[data-entity="slider-form"]').slideDown(250)}$(this).blur();return false})};ML.FullScreen=function(){};ML.Notifications=function(){var b=$('[data-entity="notifications"]');if(b.size()>0){var a=ML.settings.get("site_url")+"notifications/";$("#notifications").popup({afteropen:function(c,e){$.mobile.loading("show");$("#notifications-content").html("<p><em>Loading notifications</em></p>");$("#notifications").popup("reposition",{x:0,y:0,positionTo:"body"});$.ajax({url:a,type:"GET",contentType:"text/html; charset=UTF-8",success:function(f){$.mobile.loading("hide");b.removeClass("active");$("#notifications-content").html(f);$("#notifications").popup("reposition",{x:0,y:0,positionTo:"body"})},error:function(f){$.mobile.loading("hide");console.log("FAILED -- "+f)}})},afterclose:function(c,e){$("#notifications-content").empty();$.mobile.loading("hide")}});b.on("click",function(){$("#notifications").popup("open");return false})}b.removeClass("invisible")};ML.Upload=function(c){this.url=ML.settings.get("site_url")+"upload";this.model=c.model;this.field=c.field;if(c.hasOwnProperty("width")){this.width=c.width}else{this.width="auto"}if(c.hasOwnProperty("height")){this.height=c.height}else{this.height="auto"}var a=this;$("input#"+this.field+"-clear_id").attr("checked",false);$("input#"+this.field+"-clear_id").change(function(){a.set_image_visibility(a.field,!$(this).is(":checked"))});var b={csrfmiddlewaretoken:ML.settings.get("csrf_token"),model:this.model,field:this.field};if(this.width!=="auto"){b.width=this.width}if(this.height!=="auto"){b.height=this.height}$("input#id_"+this.field).ajaxfileupload({action:a.url,params:b,onComplete:function(g){if($("img."+a.field+"-edit").length>0){$("img."+a.field+"-edit").attr("src",g.filename)}else{var f=$("<img>");f.addClass(a.field+"-edit");f.attr("width",a.width);f.attr("height",a.height);f.attr("src",g.filename);$("input#id_"+a.field).before(f)}$("input#id_"+a.field+"_filepath").remove();var e=$("<input>");e.attr("type","hidden");e.val(g.filename);e.attr("name",a.field);e.attr("id","id_"+a.field+"_filepath");$("input#id_"+a.field).after(e);$.mobile.loading("hide");a.set_image_visibility(a.field,true);$('[data-entity="'+a.field+'-clear_id"]').show()},onStart:function(){$.mobile.loading("show");if($("img."+a.field+"-edit").length>0){a.set_image_visibility(a.field,false)}}})};ML.Upload.prototype.set_image_visibility=function(b,a){if(a){$("img."+b+"-edit").slideDown(250).show();$("#id_"+b).show();$("#"+b+"_change").show();$(".picture-rotate").show()}else{$("img."+b+"-edit").slideUp(250).hide();$("#id_"+b).hide();$("#"+b+"_change").hide();$(".picture-rotate").hide()}};ML.ImageRotate=function(c){var a=this;var e=c.field;var b=$('[data-entity="image-rotate"]');b.on("click",function(){$.ajax({url:"/manipulate/rotate",data:{field:"picture"},type:"POST",contentType:"application/x-www-form-urlencoded;charset=utf-8",dataType:"json",success:function(f){d=new Date();$("."+e).attr("src",f.filename+"?"+d.getTime())},error:function(g){try{console.log("FAILED -- "+JSON.parse(g.responseText).detail)}catch(f){console.log("FAILED");console.log(g)}}});return false})};ML.Feed=function(){var a=this;this.loading=false;this.flag;this.autoscroll=true;this.template="default";this.previous=null;this.next=false;try{var b=arguments[0]["data"];this.account=arguments[0]["account"];if(arguments[0].hasOwnProperty("flag")&&arguments[0]["flag"]){this.flag=arguments[0]["flag"]}if(arguments[0].hasOwnProperty("autoscroll")&&arguments[0]["autoscroll"]){this.autoscroll=true}if(arguments[0].hasOwnProperty("template")&&arguments[0]["template"]){this.template=arguments[0]["template"]}}catch(c){console.log(c);return}this.check_flags();this.check_slider();if(b.count==0){this.render_template("noresults-"+this.template)}else{this.button=$(".feed .ui-btn");if(b.hasOwnProperty("next")){this.next=b.next}this.render_template(this.template,b.results,function(){a.after_render()});if(this.autoscroll){$(window).scroll(function(){if(!a.loading&&a.next){var e=$(".ui-page").height()-280;if($(document).scrollTop()+$(window).height()>=e){a.refresh()}}})}}};ML.Feed.prototype.refresh=function(){var a=this;this.button.remove();this.loading=true;$.mobile.loading("show");if(this.next){$.ajax({url:this.next,type:"GET",contentType:"application/json; charset=UTF-8",dataType:"json",success:function(b){a.next=b.next;a.render_template(a.template,b.results,function(){a.after_render()})},error:function(b){console.log("FAILED -- "+b);a.after_render()}})}};ML.Feed.prototype.check_flags=function(){var b=$(".search-form").find('input[type="text"]').val();var c=new RegExp(/@\w+/g);var a=c.exec(b);this.flag=a?a[0]:null;switch(this.flag){case"@global":$('[data-role="filter-name"]').text("Global posts");$('[data-entity="filter"][rel="@local"]').removeClass("active");$('[data-entity="filter"][rel="@global"]').addClass("active");$('[data-entity="filter"][rel="@friends"]').removeClass("active");break;case"@friends":$('[data-role="filter-name"]').text("Friends' posts");$('[data-entity="filter"][rel="@local"]').removeClass("active");$('[data-entity="filter"][rel="@global"]').removeClass("active");$('[data-entity="filter"][rel="@friends"]').addClass("active");break;default:$('[data-role="filter-name"]').text("Local posts");$('[data-entity="filter"][rel="@local"]').addClass("active");$('[data-entity="filter"][rel="@global"]').removeClass("active");$('[data-entity="filter"][rel="@friends"]').removeClass("active")}$('[data-entity="filter"]').click(function(){var g=$(".search-form").find('input[type="text"]').val().split(" ");var e=[];for(var f in g){if(g[f].charAt(0)!="@"){e.push(escape(g[f]))}}if($(this).attr("rel")!="@local"){e.push($(this).attr("rel"))}location=location.pathname+"?search="+trim(e.join(" "));return false})};ML.Feed.prototype.check_slider=function(){var a=this;if($('[data-entity="slider"]').size()>0){var e=new RegExp(/range=\d+(?:\.\d*)*/g);var c=e.exec(location.search);if(c){var b=c.pop().split("=").pop();setTimeout(function(){$("#range").val(b);$("#range").slider("refresh")},250);$.cookie("ml_range",b)}$("#filter").on("click",function(f){a.slide($("#range").val());return false})}};ML.Feed.prototype.slide=function(e){var b=new RegExp(/range=\d+(?:\.\d*)*/g);var c=location.href;var a=b.exec(c);if(a){c=c.replace(b,"range="+e)}else{if(location.search==""){c+="?range="+e}else{c+="&range="+e}}location=c};ML.Feed.prototype.after_render=function(){if(this.next){this.button.show();this.button.blur()}else{this.button.hide()}$.mobile.loading("hide");this.loading=false};ML.Feed.prototype.render_template=function(j,e,k){var l=this;if(j=="noresults-default"){var g='<div class="message no-results clearfix">  <div class="message-left">    <div class="message-picture">      <img class="avatar"        src="'+ML.settings.get("static_url")+'img/picture-default.png"        alt="No results" width="48" height="48" />    </div>  </div>  <div class="message-right">    <div class="message-author">      <p><span class="bold">Oops! It\'s lonely in here.</span></p>';if(this.flag&&this.flag=="@private"){g+="<p>You don't have any private messages.</p>"}else{if(this.flag&&this.flag=="@friends"){g+="<p>You can speak to your friends here more privately. Organising a #tea-party and would like to invite them in..? Want to set up a #playdate..?</p>"}else{g+="<p>You can ask questions or share knowledge with mums within your post code. Best #nursery in the area..? #garden-sale this Saturday? Has anyone seen Fluffy..?</p><p>Really, anything :-)</p>"}}g+="    </div>  </div></div>";$(".feed").append(g)}else{if(j=="noresults-event"){var g='<div class="message no-results">  <div class="message-left">    <div class="message-picture">      <img class="avatar"           src="'+ML.settings.get("static_url")+'img/calendar.png"           alt="No results" width="48" height="48" />    </div>    <span class="message-area">404</span>  </div>  <div class="message-right">    <div class="message-author">      <p><span class="bold">Oops! It\'s lonely in here.</span></p>      <p>No activities match your search criteria.</p>      <p>You might want to increase the distance range using the target icon below.</p>      <p>You can also increase the maximum range in your account preferences.</p>    </div>  </div>  <div class="message-content clearfix"></div></div>';$(".feed").append(g)}else{for(var a in e){var n=e[a];var g="";if(j=="event"){var c=ML.settings.get("static_url")+"img/calendar.png";var i="/message/"+n.id+"/"+n.eventmonth+"/"+n.eventday+"/";var b=null;if(!this.previous||n.eventdate!=this.previous){b=n.eventdate}this.previous=n.eventdate;if(b){g+="<h3>"+b+"</h3>"}g+='<div class="message">';g+='  <div class="message-left">';g+='    <a href="'+i+'" class="message-event-link">';g+='      <span class="message-picture">';g+='        <img class="avatar"';g+='             src="'+c+'"';g+='             alt="'+n.eventdate+'" width="48" height="48" />';g+='        <span class="message-eventmonth">'+n.eventmonth+"</span>";g+='        <span class="message-eventday">'+n.eventday+"</span>";g+="      </span>";g+='      <span class="message-area">'+n.area+"</span>";if(n.postcode!=""){g+='<span class="message-distance">'+n.distance_display+"</span>"}g+="    </a>";g+="  </div>";g+='    <a href="'+i+'" class="message-right">';g+='      <span class="message-author">'+n.name+"</span>";g+='      <span class="message-time">'+n.eventtime+"</span>";g+='      <span class="message-body">';g+=n.location;for(var m in n.tags){g+=" <span>"+n.tags[m]["value"]+"</span>"}g+="      </span>";g+="    </a>";g+='  <div class="message-content clearfix">';g+='    <a href="'+i+'" class="message-tools clearfix">';g+='      <span class="message-replies">';if(n.replies.length>0){g+=' <span class="message-replies-count">'+n.replies.length+"</span>";g+=' <span class="icon icon-comment"></span>'}else{g+=' <span class="message-replies-first">Comment</span>'}g+="      </span>";g+='      <span class="bullet">&#8226;</span>';g+='      <span class="message-age" title="'+n.timestamp+'">'+n.age+"</span>";g+="    </a>";g+="  </div>";g+="</div>"}else{var f=ML.settings.get("static_url")+"img/picture-default.png";g+='<div class="message clearfix">';g+='  <div class="message-left">';g+='    <div class="message-picture">';if(n.member["is_admin"]){g+='  <a href="/message/'+n.id+'/">';var h=n.member["picture"]!=""?n.member["picture"]:f;g+='    <img class="avatar"';g+='      src="'+h+'"';g+='      alt="'+n.member["name"]+'" width="48" height="48" />';g+="  </a>"}else{if(n.recipient&&n.member["id"]==this.account){g+='<a href="/profile/'+n.recipient["slug"]+'">';var h=n.recipient["picture"]!=""?n.recipient["picture"]:f;g+='    <img class="avatar"';g+='      src="'+h+'"';g+='      alt="'+n.recipient["name"]+'" width="48" height="48" />';g+="  </a>"}else{g+='  <a href="/profile/'+n.member["slug"]+'">';var h=n.member["picture"]!=""?n.member["picture"]:f;g+='    <img class="avatar"';g+='      src="'+h+'"';g+='      alt="'+n.member["name"]+'" width="48" height="48" />';g+="  </a>"}}g+="    </div>";g+="  </div>";g+='  <div class="message-right">';g+='    <div class="message-author">';if(n.member["is_admin"]){g+='<a href="/message/'+n.id+'/">'+n.member["name"]+"</a>"}else{if(n.recipient&&n.member["id"]==this.account){g+='<a href="/profile/'+n.recipient["slug"]+'">'+n.recipient["name"]+"</a>"}else{g+='<a href="/profile/'+n.member["slug"]+'">'+n.member["name"]+"</a>"}}g+="    </div>";if(!n.member["is_admin"]){g+='<div class="message-area">'+n.area+"</div>"}g+="  </div>";g+='  <div class="message-content clearfix">';g+='    <div class="message-body">';g+='      <a href="/message/'+n.id+'/" class="message-body-link">';g+="          "+n.synopsis;for(var m in n.tags_item){g+=" <span>"+n.tags_item[m]["value"]+"</span>"}g+="      </a>";g+="    </div>";if(n.picture!=""){g+='<div class="message-image"><a href="/message/'+n.id+'/">';g+='  <img src="'+n.picture+'" alt="" width="auto" height="auto" />';g+="</a></div>"}g+='    <a href="/message/'+n.id+'/" class="message-tools clearfix">';g+='        <span class="message-replies">';if(n.replies.length>0){g+='      <span class="message-replies-count">'+n.replies.length+"</span>";g+='      <span class="icon icon-comment"></span>'}else{g+='      <span class="message-replies-first">Comment</span>'}g+="        </span>";g+='        <span class="bullet">&#8226;</span>';g+='        <span class="message-age" title="'+n.timestamp+'">'+n.age+"</span>";g+="    </a>";g+="  </div>";g+="</div>"}$(".feed").append(g)}$(".feed").append(this.button);this.button.click(function(){l.refresh();return false});if(typeof(k)=="function"){k()}}}};ML.Members=function(){var a=this;this.loading=false;this.autoscroll=true;this.next=false;try{var b=arguments[0]["data"];this.account=arguments[0]["account"];if(arguments[0].hasOwnProperty("autoscroll")&&arguments[0]["autoscroll"]){this.autoscroll=true}}catch(c){console.log(c);return}if(b.count==0){this.render_template("noresults")}else{this.button=$(".feed .ui-btn");if(b.hasOwnProperty("next")){this.next=b.next}this.render_template("default",b.results,function(){a.after_render()});if(this.autoscroll){$(window).scroll(function(){if(!a.loading&&a.next){var e=$(".ui-page").height()-280;if($(document).scrollTop()+$(window).height()>=e){a.refresh()}}})}}};ML.Members.prototype.refresh=function(){var a=this;this.button.remove();this.loading=true;$.mobile.loading("show");if(this.next){$.ajax({url:this.next,type:"GET",contentType:"application/json; charset=UTF-8",dataType:"json",success:function(b){a.next=b.next;a.render_template("default",b.results,function(){a.after_render()})},error:function(b){console.log("FAILED -- "+b);a.after_render()}})}};ML.Members.prototype.after_render=function(){if(this.next){this.button.show();this.button.blur()}else{this.button.hide()}$.mobile.loading("hide");this.loading=false};ML.Members.prototype.render_template=function(h,e,i){var j=this;if(h=="noresults"){var f='<div class="member no-results clearfix">  <div class="member-left">    <div class="picture">      <img class="avatar"        src="'+ML.settings.get("static_url")+'img/picture-default.png"        alt="No results" width="48" height="48" />    </div>  </div>  <div class="member-right">    <div class="member-body">      <p><span class="bold">Oops! It\'s lonely in here.</span></p>      <p>It seems there are no mums or bumps matching these interests!         Why don\'t you spread the word? The more the merrier they say :) </p>    </div>  </div></div>';$(".feed").append(f)}else{for(var b in e){var c=e[b];var f='<div class="member clearfix">';f+='  <div class="member-left">';f+='    <div class="picture"><a href="/profile/'+c.slug+'"><img';f+='         class="avatar"';var g=ML.settings.get("static_url")+"img/picture-default.png";if(c.picture!=""){g=c.picture}f+='         src="'+g+'"';f+='         alt="'+c.name+'" width="48" height="48" /></a></div>';f+="    </div>";f+='  <div class="member-right">';f+='    <div class="member-author">';f+='      <a href="/profile/'+c.slug+'">'+c.name+"</a>";if(c.distance_display!="N/A"){f+="    <span>("+c.distance_display+")</span>"}f+="    </div>";f+='    <div class="member-body">';var a=c.interests.split(" ");for(tag in a){if(a[tag]){f+='<span><a href="/members/?search='+a[tag]+'">#'+a[tag]+"</a></span> "}}f+="    </div>";f+='    <div class="member-tools clearfix">';if(c.friend_status&&c.friend_status=="Approved"){f+='<img src="'+ML.settings.get("static_url")+'img/z.gif" class="icon icon-friend" alt="" />'}else{if(c.friend_status&&c.friend_status=="Pending"){f+='<img src="'+ML.settings.get("static_url")+'img/z.gif" class="icon icon-pendingfriend" alt="" />'}else{if(c.friend_status&&c.friend_status=="Requesting"){f+='<a class="addtofriend" href="#'+this.account+","+c.id+'" rel="confirm">';f+=' <img src="'+ML.settings.get("static_url")+'img/z.gif" class="icon icon-confirmfriend" alt="" />';f+="</a>"}else{if(c.friend_status&&c.friend_status=="Blocked"){f+="<span>&nbsp;</span>"}else{f+='<a class="addtofriend" href="#'+this.account+","+c.id+'">';f+='  <img src="'+ML.settings.get("static_url")+'img/z.gif" class="icon icon-addtofriend" alt="" />';f+="</a>"}}}}f+="    </div>";f+="  </div>";f+="</div>";$(".feed").append(f)}$(".feed").append(this.button);this.button.click(function(){j.refresh();return false});new ML.AddToFriends({"class":"addtofriend"});if(typeof(i)=="function"){i()}}};ML.Messages=function(a){this.mode=a&&a.hasOwnProperty("edit-mode")&&a["edit-mode"]?"PATCH":"POST";this.event_id=a&&a.hasOwnProperty("event_id")?a.event_id:null;this.refresh()};ML.Messages.prototype.refresh=function(){var b=this;$("textarea.message-body").unbind();$("textarea.message-body").elastic();var c=$(".message-visibility").find('option[selected="selected"]');$('a[data-entity="message-type"]').each(function(){if($(this).data("type")==c.val()){$(this).addClass("selected")}});$('a[data-entity="message-type"]').click(function(){$('a[data-entity="message-type"]').removeClass("selected");$(this).addClass("selected");$(".message-visibility").find("option").attr("selected",null);$(".message-visibility").find('option[value="'+$(this).data("type")+'"]').attr("selected","selected");return false});function a(e){if(e==0){$('[data-entity="occurrence-until"]').slideUp(250)}else{$('[data-entity="occurrence-until"]').slideDown(250)}}a($('[data-entity="occurrence"] input:checked').val());$('[data-entity="occurrence"] input').off("change").on("change",function(){a($(this).val())});$('[data-entity="message"]').each(function(){var e=$(this);if(!e.data("bound")){e.data("bound",true);var f=null;if(e.data("type")=="private-message"){if(e.find('[data-entity="recipient"]').size()>0){e.find('[data-entity="recipient"]').on("click",function(){$(this).off("click").on("click",function(){return false});f=$(this).data("id");$(this).html('<p class="message-recipient">To: <strong>'+$(this).text()+"</strong></p>");$('[data-entity="friends-list"]').replaceWith($(this));return false})}else{f=e.data("recipient")}}e.find('[data-entity="button"]').bind("click",function(){var m=[];var l=trim(e.find(".message-body").val());var h=null;var o=false;if(e.data("type")=="private-message"){h=0;o=true;if(!f){m.push("<p>Please select a friend</p>")}}else{var p=e.find(".message-visibility");if(p.size()>0){h=e.find(".message-visibility").find('option[selected="selected"]').val()}else{h=2}}var j=null;if($(".picture-edit").size()>0&&$(".picture-edit").is(":visible")){j=$(".picture-edit").attr("src")}var k={body:l,picture:j,visibility:parseInt(h),mid:e.data("mid"),recipient:f};if(b.event_id){k.id=b.event_id}var q=$("#id_tags");if(q.size()>0){k.tags=q.val()}var n=false;if(e.find(".message-name").length>0){n=true;k.name=e.find(".message-name").val();var i=e.find(".message-date").val();k.eventdate=i;if(e.find(".message-time").val()==""){k.eventdate+=" 00:00"}else{k.eventdate+=" "+e.find(".message-time").val()}if(e.find(".message-endtime").val()!=""){k.eventenddate=i+" "+e.find(".message-endtime").val()}k.location=e.find(".message-location").val();k.visibility=3;k.occurrence=parseInt(e.find('[data-entity="occurrence"] input:checked').val());k.occurs_until=e.find('[data-entity="occurrence-until"] input').val()}var g=true;e.find('*[required="required"]').each(function(){if($(this).val()==""){m.push("<p><strong>"+$(this).data("name")+"</strong> is required</p>")}});if(m.length>0){g=false;$("#errors-content").html(m.join(""));$("#errors").popup("open")}if(g){$.ajax({url:ML.settings.get("api_url")+"message/post",data:JSON.stringify(k),type:b.mode,contentType:"application/json; charset=UTF-8",dataType:"json",success:function(r){var s=e.data("type")=="message"?true:false;if(ML.settings.get("debug")){b.after_post(n,o)}else{mixpanel.track("Post Sent",{"Is Event":n},function(){b.after_post(n,o)})}},error:function(s){try{console.log("FAILED -- "+JSON.parse(s.responseText).detail)}catch(r){console.log("FAILED -- "+s)}}})}})}});$('a[data-entity="message"]').click(function(){var e=$(this);var f=$('div[data-entity="message"]');if(f.is(":visible")){f.slideUp(250,function(){f.find("textarea").val("")})}else{f.slideDown(250,function(){if(f.find('input[data-type="search"]').size()>0){f.find('input[data-type="search"]').focus()}else{f.find("textarea").focus()}})}return false})};ML.Messages.prototype.after_post=function(a,b){if(a){location=ML.settings.get("site_url")+"events/"}else{if(b){location.reload(true)}else{location=ML.settings.get("site_url")}}};ML.AutoField=function(b){var a=this;this.model=b.model;this.entity=b.entity;this.field=$("#id_"+b.field);this.widget=b.hasOwnProperty("widget")?b.widget:null;this.value=this.field.val();switch(this.widget){case"elastic":this.value=$("#id_"+b.field+"-twin").text();break;case"select":this.value=$("#id_"+b.field).data("value");var c=this.field.find("input");c.click(function(){a.field.val($(this).val());a.update()});break;case"date":this.field.on("change",function(){var e=a.field.val();if(e!==a.value){a.update()}});break}this.field.on("blur",function(){var e=a.field.val();if(e!==a.value){a.update()}});$(window).on("beforeunload",function(g){var f=a.field.val();if(f&&f!==a.value){a.update(function(){return true})}})};ML.AutoField.prototype.update=function(e){this.field.attr("disabled","disabled");var b=ML.settings.get("api_url")+this.model+"/"+this.entity+"/";var c={};c[this.field.attr("name")]=this.field.val();var a=this;$.ajax({url:b,data:JSON.stringify(c),async:false,type:"PATCH",contentType:"application/json; charset=UTF-8",dataType:"json",success:function(f){a.done();if(typeof(e)=="function"){e()}},error:function(j){try{var h=["Oops something went wrong!\n"];var k=JSON.parse(j.responseText);for(var i in k){h.push(k[i])}alert(h.join("\n"))}catch(g){console.log("FAILED -- "+g)}a.done();if(typeof(e)=="function"){e()}}})};ML.AutoField.prototype.done=function(){this.value=this.field.val();this.field.attr("disabled",null)};ML.AddToFriends=function(b){this.classname=b["class"];var a=this;$("a."+this.classname).off("click").on("click",function(){var f=$(this);var h=f.attr("href").replace("#","").split(",");var e=ML.settings.get("api_url")+"friendships/";var c=0;if(f.attr("rel")=="block"){c=2}var g={from_member:parseInt(h[0]),to_member:parseInt(h[1]),status:c};$.ajax({url:e,data:JSON.stringify(g),type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",success:function(i){f.unbind("click").click(function(){return false});if(f.attr("rel")=="confirm"){f.find("img").removeClass("icon-addtofriend").addClass("icon-friend");f.find("span").text("Friend")}else{if(f.attr("rel")=="block"){f.find("img").removeClass("icon-addtofriend").addClass("icon-addtofriend");f.find("span").text("Blocked")}else{f.find("img").removeClass("icon-addtofriend").addClass("icon-pendingfriend");f.find("span").text("Requested")}}},error:function(j){try{if(JSON.parse(j.responseText).detail=="Already Exists"){}}catch(i){console.log("FAILED -- "+i)}}});return false})};