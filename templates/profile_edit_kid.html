{% extends "base.html" %}

{% block extrahead %}
<script type="text/javascript">
    $(document).bind("mobileinit", function () {
        $.mobile.ajaxEnabled = false;
        $.mobile.linkBindingEnabled = false;
        $.ns = 'jqm';
    });
</script>
<script type="text/javascript" src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
<script src="{{ STATIC_URL }}js/jqm-datebox.comp.calbox.min.js"></script>
{% endblock %}

{% block bodyclass %}edit-mode{% endblock %}
{% block pagetheme %}c{% endblock %}
{% block headertheme %}c{% endblock %}
{% block contenttheme %}c{% endblock %}
{% block footertheme %}c{% endblock %}

{% block backbutton %}
<a data-role="button"
   data-icon="arrow-l"
   data-iconpos="notext"
   data-wrapperels="span"
   data-rel="back"
   href="{{ SITE_URL }}profile/edit/kids">Back</a>
{% endblock %}

{% block content %}
    <header>
        <h2>{{ kid.fullname }} (edit kid)</h2>
    </header>
    <section>

        <form class="form-card box" action="" method="post">{% csrf_token %}
            <div class="form-field">
                {{ form.fullname.label_tag }}
                {{ form.fullname }}
                <p class="description">{{ form.fullname.help_text }}</p>
            </div>
            <div class="form-field">
                {{ form.gender.label_tag }}
                <fieldset data-role="controlgroup" id="id_gender" name="gender" data-value="{{ form.gender.value }}">
                {% for choice in form.gender.field.choices %}
                    {% if choice.0 != '' %}
                    <input name="gender" id="gender-choice-{{ choice.0 }}" type="radio"
                           value="{{ choice.0 }}"
                           {% if choice.0 == form.gender.value %}checked="checked"{% endif %}>
                    <label for="gender-choice-{{ choice.0 }}">{{ choice.1 }}</label>
                    {% endif %}
                {% endfor %}
                </fieldset>
                <p class="description">{{ form.gender.help_text }}</p>
            </div>
            <div class="form-field">
                {{ form.dob.label_tag }}
                <input type="date" name="dob" id="{{ form.dob.id_for_label }}" value="{{ form.dob.value }}"
                       data-role="datebox"
                       data-options='{"mode": "calbox", "calUsePickers": true, "overrideDateFormat": "%Y-%m-%d", "beforeToday": true}' />
                <p class="description">{{ form.dob.help_text }}</p>
            </div>
            <div class="form-field">
                {{ form.visibility.label_tag }}
                <fieldset data-role="controlgroup" id="id_visibility" name="visibility" data-value="{{ form.visibility.value }}">
                {% for choice in form.visibility.field.choices %}
                    {% if choice.0 != '' %}
                    <input name="visibility" id="visibility-choice-{{ choice.0 }}" type="radio"
                           value="{{ choice.0 }}"
                           {% if choice.0 == form.visibility.value %}checked="checked"{% endif %}>
                    <label for="visibility-choice-{{ choice.0 }}">{{ choice.1 }}</label>
                    {% endif %}
                {% endfor %}
                </fieldset>
                <p class="description">{{ form.visibility.help_text }}</p>
            </div>
        </form>
    </section>
    <footer> </footer>
{% endblock %}

{% block extrajs %}{{ block.super }}
<script type="text/javascript">
    $(document).on('ml.Ready', function () {
        // Add the datebox CSS last
        $('head').append('<link type="text/css" href="{{ STATIC_URL }}css/jqm-datebox.min.css" rel="stylesheet" />');
        new ML.AutoField({ 'entity': {{ kid.id }}, 'field': 'fullname', 'api_url': '{{ api_url }}', 'token': '{{ csrf_token }}' });
        new ML.AutoField({ 'entity': {{ kid.id }}, 'field': 'gender', 'api_url': '{{ api_url }}', 'token': '{{ csrf_token }}', 'widget': 'select' });
        new ML.AutoField({ 'entity': {{ kid.id }}, 'field': 'dob', 'api_url': '{{ api_url }}', 'token': '{{ csrf_token }}', 'widget': 'date' });
        new ML.AutoField({ 'entity': {{ kid.id }}, 'field': 'visibility', 'api_url': '{{ api_url }}', 'token': '{{ csrf_token }}', 'widget': 'select' });
    });
</script>
{% endblock %}
